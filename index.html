<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2D Air Hockey Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
    }
    canvas {
      display: block;
      margin: auto;
      background: #111;
      border: 2px solid #444;
    }
    #scoreBoard, #timer {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      z-index: 2;
    }
    #timer {
      left: auto;
      right: 10px;
    }
    #settingsMenu {
      display: none;
      position: absolute;
      top: 60px;
      left: 10px;
      background: #222;
      border: 1px solid #555;
      padding: 10px;
      z-index: 2;
    }
    #controls {
      position: absolute;
      bottom: 10px;
      left: 10px;
      z-index: 2;
    }
    #controls button {
      margin-right: 10px;
      padding: 5px 10px;
      background: #444;
      color: #fff;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="600" height="800"></canvas>
  <div id="scoreBoard">Score: 0 | High Score: 0</div>
  <div id="timer">‚è± Time: 60</div>

  <!-- Settings Menu -->
  <div id="settingsMenu">
    <h3>Settings ‚öô</h3>
    <label><input type="checkbox" id="soundToggle" checked> Sound On</label><br>
    <button onclick="closeSettings()">Close</button>
  </div>

  <!-- Controls -->
  <div id="controls">
    <button onclick="togglePause()">‚èØ Pause/Resume</button>
    <button onclick="restartGame()">üîÑ Restart</button>
    <button onclick="openSettings()">‚öô Settings</button>
    <button onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
  </div>

  <!-- Sound Effects -->
  <audio id="goalSound" src="https://www.soundjay.com/button/beep-07.wav"></audio>
  <audio id="hitSound" src="https://www.soundjay.com/button/button-3.wav"></audio>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreBoard = document.getElementById('scoreBoard');
    const goalSound = document.getElementById('goalSound');
    const hitSound = document.getElementById('hitSound');
    let width = canvas.width;
    let height = canvas.height;

    let player = { x: width / 2, y: height - 60, r: 30 };
    let ai = { x: width / 2, y: 60, r: 30 };
    let puck = { x: width / 2, y: height / 2, dx: 3, dy: 3, r: 15 };

    let score = 0;
    let highScore = localStorage.getItem("highScore") || 0;
    let paused = false;
    let timeLeft = 60;
    let timerInterval;
    let aiSpeed = 0.1;
    let speedMultiplier = 1;
    let level = 1;

    canvas.addEventListener("mousemove", e => {
      if (paused) return;
      const rect = canvas.getBoundingClientRect();
      player.x = e.clientX - rect.left;
      player.y = e.clientY - rect.top;
    });

    function drawCircle(x, y, r, color, border = 0) {
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
      if (border > 0) {
        ctx.lineWidth = border;
        ctx.strokeStyle = "#fff";
        ctx.stroke();
      }
      ctx.closePath();
    }

    function drawCenterLine() {
      ctx.beginPath();
      ctx.setLineDash([10, 10]);
      ctx.moveTo(0, height / 2);
      ctx.lineTo(width, height / 2);
      ctx.strokeStyle = "#444";
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.closePath();
    }

    function resetPuck() {
      puck.x = width / 2;
      puck.y = height / 2;
      puck.dx = (Math.random() < 0.5 ? -1 : 1) * 3;
      puck.dy = (Math.random() < 0.5 ? -1 : 1) * 3;
    }

    function openSettings() {
      document.getElementById("settingsMenu").style.display = "block";
    }

    function closeSettings() {
      document.getElementById("settingsMenu").style.display = "none";
    }

    function togglePause() {
      paused = !paused;
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    function updateAIBehavior() {
      aiSpeed = 0.05 + level * 0.05;
    }

    function setLevel(val) {
      level = parseInt(val);
      speedMultiplier = 1 + (level - 1) * 0.5;
      updateAIBehavior();
    }

    function draw() {
      if (paused) {
        requestAnimationFrame(draw);
        return;
      }

      ctx.clearRect(0, 0, width, height);
      drawCenterLine();

      puck.x += puck.dx * speedMultiplier;
      puck.y += puck.dy * speedMultiplier;

      if (puck.x < puck.r || puck.x > width - puck.r) puck.dx *= -1;

      if (puck.y < puck.r || puck.y > height - puck.r) {
        if (puck.y < height / 2) {
          score++;
          if (document.getElementById("soundToggle").checked) goalSound.play();
        } else {
          score = 0;
        }

        if (score > highScore) {
          highScore = score;
          localStorage.setItem("highScore", highScore);
        }

        resetPuck();
      }

      if (puck.y < height / 2) {
        ai.x += (puck.x - ai.x) * aiSpeed;
      }

      [player, ai].forEach(paddle => {
        let dx = puck.x - paddle.x;
        let dy = puck.y - paddle.y;
        let dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < puck.r + paddle.r) {
          let angle = Math.atan2(dy, dx);
          puck.dx = Math.cos(angle) * 4;
          puck.dy = Math.sin(angle) * 4;
          if (document.getElementById("soundToggle").checked) hitSound.play();
        }
      });

      drawCircle(puck.x, puck.y, puck.r, "white", 10);
      drawCircle(player.x, player.y, player.r, "blue", 20);
      drawCircle(ai.x, ai.y, ai.r, "red", 20);

      scoreBoard.innerHTML = `Score: ${score} | High Score: ${highScore}`;
      requestAnimationFrame(draw);
    }

    function startTimer() {
      timeLeft = 60;
      document.getElementById("timer").innerText = `‚è± Time: ${timeLeft}`;
      if (timerInterval) clearInterval(timerInterval);

      timerInterval = setInterval(() => {
        if (!paused) {
          timeLeft--;
          document.getElementById("timer").innerText = `‚è± Time: ${timeLeft}`;
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            alert("‚è∞ Time's up! Final Score: " + score);
            restartGame();
          }
        }
      }, 1000);
    }

    function restartGame() {
      score = 0;
      resetPuck();
      startTimer();
      draw();
    }

    setLevel(1);
    startTimer();
    draw();
  </script>
</body>
</html>
